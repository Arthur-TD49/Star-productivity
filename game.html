<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Tasker Pro - Dashboard</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --mac-bg: rgba(255, 255, 255, 0.75);
            --mac-border: rgba(255, 255, 255, 0.5);
            --accent: #007AFF;
            --success: #28cd41;
            --danger: #FF3B30;
            --surface: rgba(255, 255, 255, 0.4);
        }

        body {
            background: url('https://images.unsplash.com/photo-1497215728101-856f4ea42174?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            background-size: cover;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        .app-container {
            width: 95%; max-width: 1100px; height: 85vh;
            background: var(--mac-bg);
            backdrop-filter: blur(50px) saturate(200%);
            -webkit-backdrop-filter: blur(50px) saturate(200%);
            border-radius: 20px; border: 1px solid var(--mac-border);
            display: flex; flex-direction: column;
            box-shadow: 0 40px 100px rgba(0,0,0,0.25);
            animation: appAppear 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes appAppear { from { opacity: 0; transform: scale(0.98) translateY(10px); } }

        /* Barre de titre */
        .title-bar {
            height: 55px; display: flex; align-items: center; padding: 0 20px;
            background: rgba(255,255,255,0.1); border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .dots { display: flex; gap: 8px; width: 60px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .red { background: #FF5F56; } .yellow { background: #FFBD2E; } .green { background: #27C93F; }

        .xp-container { flex: 1; margin: 0 30px; }
        .xp-label { font-size: 10px; font-weight: 800; color: #555; margin-bottom: 5px; text-transform: uppercase; }
        .xp-bar { height: 8px; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; }
        #xp-fill { height: 100%; background: linear-gradient(90deg, #007AFF, #5AC8FA); width: 0%; transition: width 0.5s ease; }

        .star-wallet { 
            background: rgba(255,255,255,0.9); padding: 6px 15px; border-radius: 12px; 
            font-weight: 700; color: #d35400; display: flex; align-items: center; gap: 6px;
        }

        /* Layout */
        .main-layout { display: flex; flex: 1; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 220px; padding: 20px; background: rgba(255,255,255,0.1); border-right: 1px solid rgba(0,0,0,0.05); }
        .widget { 
            background: var(--surface); padding: 15px; border-radius: 15px; 
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.3); text-align: center;
        }
        .widget small { display: block; font-size: 9px; font-weight: 800; color: #777; margin-bottom: 4px; }

        /* Colonnes */
        .shop-column { width: 300px; padding: 20px; overflow-y: auto; background: rgba(255,255,255,0.05); }
        .task-column { flex: 1; padding: 20px; overflow-y: auto; }

        .card { 
            background: white; padding: 16px; border-radius: 16px; margin-bottom: 12px;
            border: 1px solid rgba(0,0,0,0.04); transition: all 0.2s ease;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }

        /* Formulaire */
        .input-group { background: white; padding: 15px; border-radius: 16px; margin-bottom: 20px; }
        input, select { 
            width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; 
            border: 1px solid #ddd; outline: none; box-sizing: border-box;
        }

        .btn { 
            border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; 
            font-weight: 600; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-primary { background: var(--accent); color: white; width: 100%; }
        .btn-success { background: var(--success); color: white; }
        .btn-ghost { background: transparent; color: #888; }
        .btn-ghost:hover { color: var(--danger); background: #fff1f0; }

        /* Toasts */
        #notify-stack { position: fixed; top: 20px; right: 20px; z-index: 2000; }
        .toast {
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 12px 20px; border-radius: 12px; margin-bottom: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid white;
            animation: toastIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes toastIn { from { transform: translateX(100%); opacity: 0; } }

        .timer-float {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            background: #1d1d1f; color: white; padding: 12px 24px;
            border-radius: 50px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000;
        }

        .badge { font-size: 11px; padding: 4px 8px; border-radius: 6px; font-weight: 700; background: #FFF9E6; color: #D4AF37; }
    </style>
</head>
<body>

<div id="notify-stack"></div>
<div id="timer-ui" class="timer-float" style="display:none"></div>

<div class="app-container">
    <div class="title-bar">
        <div class="dots">
            <div class="dot red"></div>
            <div class="dot yellow"></div>
            <div class="dot green"></div>
        </div>
        <div class="xp-container">
            <div class="xp-label">Niveau <span id="lvl-badge">1</span></div>
            <div class="xp-bar"><div id="xp-fill"></div></div>
        </div>
        <div class="star-wallet">
            <i data-lucide="star" size="18" fill="#f39c12"></i>
            <span id="starsDisplay">0</span>
        </div>
    </div>

    <div class="main-layout">
        <aside class="sidebar">
            <div class="widget">
                <small>STATUT</small>
                <span id="rankName">Stagiaire</span>
            </div>
            <div class="widget">
                <small>PROCHAIN NIVEAU</small>
                <span id="next-lvl-xp">150 XP</span>
            </div>
        </aside>

        <section class="shop-column">
            <h3><i data-lucide="shopping-bag" size="18"></i> Boutique</h3>
            <div class="card">
                <div style="font-weight:700;">üéÆ Session Gaming</div>
                <div style="font-size:11px; color:#888; margin-bottom:12px;">Pause d√©tente (60m)</div>
                <button class="btn btn-primary" onclick="buy(150, 'Gaming', 60)">150 ‚≠ê</button>
            </div>
            <div class="card">
                <div style="font-weight:700;">üìñ Lecture</div>
                <div style="font-size:11px; color:#888; margin-bottom:12px;">Apprentissage (30m)</div>
                <button class="btn btn-primary" onclick="buy(50, 'Lecture', 30)">50 ‚≠ê</button>
            </div>
            <div class="card" style="border: 1px solid var(--accent);">
                <div style="font-weight:700; color:var(--accent);">‚ö° Deep Work</div>
                <div style="font-size:11px; color:#888; margin-bottom:12px;">Focus intense (25m)</div>
                <button class="btn btn-primary" style="background:#000" onclick="startFocus()">Lancer</button>
            </div>
        </section>

        <main class="task-column">
            <h3><i data-lucide="check-circle" size="18"></i> Missions</h3>
            <div class="input-group">
                <input type="text" id="taskName" placeholder="Nouvelle mission...">
                <div style="display:flex; gap:10px;">
                    <select id="taskValue">
                        <option value="20">Facile (20 ‚≠ê)</option>
                        <option value="50" selected>Moyen (50 ‚≠ê)</option>
                        <option value="150">Difficile (150 ‚≠ê)</option>
                    </select>
                    <button class="btn btn-primary" onclick="addTask()" style="width:60px;"><i data-lucide="plus"></i></button>
                </div>
            </div>
            <div id="taskList"></div>
        </main>
    </div>
</div>

<script>
    // --- √âTAT ---
    let stars = parseInt(localStorage.getItem('stars')) || 0;
    let xp = parseInt(localStorage.getItem('xp')) || 0;
    let lvl = parseInt(localStorage.getItem('lvl')) || 1;
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    const ranks = ["Stagiaire", "Apprenti", "Expert", "Ma√Ætre", "L√©gende"];

    // --- √âQUILIBRAGE ---
    const getNextLevelXP = () => lvl * 150;

    // --- NOTIFICATIONS ---
    function sendNotify(title, msg) {
        const stack = document.getElementById('notify-stack');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `<b>${title}</b><br><small>${msg}</small>`;
        stack.appendChild(toast);
        setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 400); }, 3500);
    }

    // --- UI ---
    function updateUI() {
        document.getElementById('starsDisplay').innerText = stars;
        document.getElementById('lvl-badge').innerText = lvl;
        document.getElementById('rankName').innerText = ranks[Math.min(lvl-1, 4)];
        document.getElementById('next-lvl-xp').innerText = getNextLevelXP() + " XP";
        
        let progress = (xp / getNextLevelXP()) * 100;
        document.getElementById('xp-fill').style.width = `${progress}%`;

        localStorage.setItem('stars', stars);
        localStorage.setItem('xp', xp);
        localStorage.setItem('lvl', lvl);
        localStorage.setItem('tasks', JSON.stringify(tasks));
        
        renderTasks();
        lucide.createIcons();
    }

    function addTask() {
        const input = document.getElementById('taskName');
        const val = document.getElementById('taskValue');
        if (!input.value.trim()) return;
        tasks.push({ id: Date.now(), name: input.value, reward: parseInt(val.value) });
        input.value = '';
        updateUI();
    }

    function completeTask(id) {
        const task = tasks.find(t => t.id === id);
        stars += task.reward;
        xp += Math.floor(task.reward / 2);

        if (xp >= getNextLevelXP()) {
            xp -= getNextLevelXP();
            lvl++;
            sendNotify("LEVEL UP ! üöÄ", `Vous √™tes niveau ${lvl}`);
        }
        tasks = tasks.filter(t => t.id !== id);
        sendNotify("Mission accomplie", `+${task.reward} ‚≠ê`);
        updateUI();
    }

    function deleteTask(id) { tasks = tasks.filter(t => t.id !== id); updateUI(); }

    function renderTasks() {
        const list = document.getElementById('taskList');
        list.innerHTML = tasks.length === 0 ? '<p style="text-align:center; color:#888;">Repos m√©rit√© !</p>' : '';
        tasks.forEach(t => {
            const div = document.createElement('div');
            div.className = 'card task-item';
            div.style.display = 'flex'; div.style.justifyContent = 'space-between'; div.style.alignItems = 'center';
            div.innerHTML = `<div><b>${t.name}</b><br><span class="badge">‚≠ê ${t.reward}</span></div>
                <div style="display:flex; gap:5px;">
                    <button class="btn btn-ghost" onclick="deleteTask(${t.id})"><i data-lucide="trash-2" size="16"></i></button>
                    <button class="btn btn-success" onclick="completeTask(${t.id})">OK</button>
                </div>`;
            list.appendChild(div);
        });
    }

    // --- TIMER PERSISTANT ---
    let activeInterval;
    function startTimer(label, mins) {
        const endTime = Date.now() + (mins * 60 * 1000);
        localStorage.setItem('timerEnd', endTime);
        localStorage.setItem('timerLabel', label);
        runTimerLogic();
    }

    function runTimerLogic() {
        const ui = document.getElementById('timer-ui');
        const endTime = localStorage.getItem('timerEnd');
        const label = localStorage.getItem('timerLabel');
        if (!endTime) return;

        clearInterval(activeInterval);
        ui.style.display = 'flex';
        activeInterval = setInterval(() => {
            const diff = endTime - Date.now();
            if (diff <= 0) {
                clearInterval(activeInterval);
                ui.style.display = 'none';
                localStorage.removeItem('timerEnd');
                sendNotify("Termin√© !", label + " est fini.");
                return;
            }
            const m = Math.floor(diff / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            ui.innerHTML = `<i data-lucide="clock" size="18"></i> <span><b>${label}</b> ${m}:${s<10?'0':''}${s}</span>`;
            lucide.createIcons();
        }, 1000);
    }

    function buy(cost, label, mins) {
        if (stars >= cost) { stars -= cost; startTimer(label, mins); updateUI(); }
        else { sendNotify("Erreur", "Pas assez d'√©toiles !"); }
    }

    function startFocus() { startTimer("Focus", 25); sendNotify("Focus", "C'est parti !"); }

    updateUI();
    runTimerLogic();
</script>
</body>
</html>
